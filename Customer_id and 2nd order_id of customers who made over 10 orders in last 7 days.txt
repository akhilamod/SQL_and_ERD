select customer_id, order_id
from (
        select 
            customer_id, order_datetime, order_id,
            dense_rank() over(
                    partition by customer_id
                    order by order_datetime 
                    ) as r,
            count(order_id) over(
                    partition by customer_id
                    ) as c
        from Orders 
        where order_datetime < now() - INTERVAL 7 days
   )
where 
    r = 2
    and c > 10
